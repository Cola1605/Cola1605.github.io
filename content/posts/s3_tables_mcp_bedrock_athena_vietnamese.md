---
title: "X√¢y d·ª±ng MCP Server query S3 Tables (Iceberg) b·∫±ng ng√¥n ng·ªØ t·ª± nhi√™n v·ªõi AWS Lambda + Bedrock + Athena"
date: 2025-10-14
draft: false
categories: ["AWS", "Data-Engineering", "AI"]
tags: ["S3-Tables", "Iceberg", "MCP", "Bedrock", "Athena", "Lambda", "Data-Analysis", "Natural-Language-Query"]
description: "H∆∞·ªõng d·∫´n x√¢y d·ª±ng MCP Server cho ph√©p query S3 Tables (Iceberg) b·∫±ng ng√¥n ng·ªØ t·ª± nhi√™n, t·ª± ƒë·ªông sinh SQL v√† tr·∫£ v·ªÅ k·∫øt qu·∫£ qua Claude."
---

**T√°c gi·∫£:** Ryuto Yoda (ËàáÁî∞Èæç‰∫∫)  
**B·ªô ph·∫≠n:** ÂÖ®Á§æ„Éá„Éº„ÇøÊäÄË°ìÂ±Ä „Éá„Éº„Çø„Ç§„É≥„ÉÜ„Ç∞„É¨„Éº„Ç∑„Éß„É≥„ÉÅ„Éº„É† (Data Integration Team)  
**Ng√†y ƒëƒÉng:** 14/10/2025  
**Ngu·ªìn:** https://developers.cyberagent.co.jp/blog/archives/59292/

**Category:** „Ç®„É≥„Ç∏„Éã„Ç¢ (Engineer)  
**Tags:** #MCP #„Éá„Éº„ÇøÂàÜÊûê #„Éá„Éº„ÇøÂü∫Áõ§ #ÂÖ®Á§æ„Éá„Éº„ÇøÊäÄË°ìÂ±Ä #ÁîüÊàêAI  
**Hatena Bookmarks:** 4

---

## üìã Gi·ªõi thi·ªáu

T√¥i l√† Ryuto Yoda (ËàáÁî∞Èæç‰∫∫), thu·ªôc **Data Integration Team** trong **Corporate Data Technology Division**.

Khi s·ª≠ d·ª•ng **Amazon S3 Tables** ƒë·ªÉ qu·∫£n l√Ω data d∆∞·ªõi d·∫°ng **Iceberg**, b·∫°n c√≥ th·ªÉ th·ª±c hi·ªán t·ª± ƒë·ªông compaction cho Iceberg tables v√† ki·ªÉm so√°t quy·ªÅn ·ªü level table. Nh·ªù ƒë√≥, vi·ªác c√¢n b·∫±ng gi·ªØa **query performance** v√† **data governance** tr·ªü n√™n d·ªÖ d√†ng h∆°n so v·ªõi v·∫≠n h√†nh S3 bucket truy·ªÅn th·ªëng.

L·∫ßn n√†y, t√¥i s·∫Ω x√¢y d·ª±ng m·ªôt c∆° ch·∫ø: **g·ª≠i c√¢u h·ªèi b·∫±ng ng√¥n ng·ªØ t·ª± nhi√™n t·ª´ Claude**, h·ªá th·ªëng s·∫Ω **t·ª± ƒë·ªông sinh SQL query t∆∞∆°ng ·ª©ng**, **Athena th·ª±c thi query ƒë√≥** v√† **tr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng JSON k√®m summary**.

Lambda function ho·∫°t ƒë·ªông nh∆∞ **MCP (Model Context Protocol) server**, th√¥ng qua Bedrock Guardrails v√† audit logs, cho ph√©p g·ªçi c√°c tools nh∆∞ `test_connection`, `text_to_sql`, `execute_query`, `fetch_query_results` t·ª´ **Claude (browser version)**.

---

## üèóÔ∏è Architecture v√† M·ª•c ƒë√≠ch

### Workflow c·ª• th·ªÉ

H·ªá th·ªëng ho·∫°t ƒë·ªông theo flow sau:

#### 1Ô∏è‚É£ **G·ª≠i c√¢u h·ªèi t·ª´ Claude**
- Nh·∫≠n c√¢u h·ªèi b·∫±ng ng√¥n ng·ªØ t·ª± nhi√™n (ti·∫øng Nh·∫≠t) qua Bedrock

#### 2Ô∏è‚É£ **T·ª± ƒë·ªông sinh SQL query**
- Claude c·ªßa Bedrock t·ª± ƒë·ªông generate SQL t∆∞∆°ng ·ª©ng v·ªõi c√¢u h·ªèi

#### 3Ô∏è‚É£ **Th·ª±c thi query tr√™n Athena**
- Athena th·ª±c thi SQL ƒë√£ generate v√† l·∫•y k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng JSON

#### 4Ô∏è‚É£ **Tr·∫£ v·ªÅ k·∫øt qu·∫£ v√† summary**
- Lambda (MCP server) tr·∫£ v·ªÅ JSON result v√† summary cho Claude

### üéØ L·ª£i √≠ch c·ªßa Architecture

Lambda ho·∫°t ƒë·ªông nh∆∞ **MCP server**, th√¥ng qua **Bedrock Guardrails** v√† **audit logs**, cho ph√©p:

‚úÖ Thao t√°c Iceberg tables m√† kh√¥ng c·∫ßn vi·∫øt SQL tr·ª±c ti·∫øp  
‚úÖ C√¢u h·ªèi, generated SQL, v√† execution results ƒë·ªÅu ƒë∆∞·ª£c ghi v√†o audit log  
‚úÖ H·ªó tr·ª£ **data governance** v√† **performance improvement**  
‚úÖ K·∫øt h·ª£p query performance v·ªõi data governance  

![Architecture Diagram](https://developers.cyberagent.co.jp/blog/archives/59292/)

---

## üõ†Ô∏è C√°c b∆∞·ªõc x√¢y d·ª±ng

### üìå ƒêi·ªÅu ki·ªán ti√™n quy·∫øt

#### **Amazon S3 Tables / Iceberg Tables**

- Iceberg tables d·∫°ng S3 Tables ƒë√£ ƒë∆∞·ª£c t·∫°o s·∫µn
- Trong v√≠ d·ª• n√†y, s·ª≠ d·ª•ng table `analytics_namespace.slack_messages`
- **B·∫≠t t√≠ch h·ª£p Amazon S3 Tables v·ªõi AWS analytics services**

![AWS Analytics Services Integration](https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-tables-integration-overview.html)

**Tham kh·∫£o:** [Amazon S3 Tables integration with AWS analytics services overview](https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-tables-integration-overview.html)

#### **Amazon Athena**

- C√≥ th·ªÉ query Iceberg tables c·ªßa S3 Tables t·ª´ Athena
- Athena catalog (v√≠ d·ª•: `AwsDataCatalog`) v√† workgroup (v√≠ d·ª•: `primary`) ƒë√£ ƒë∆∞·ª£c config

#### **AWS Account / Permissions**

- C√≥ IAM permissions ƒë·ªÉ t·∫°o v√† th·ª±c thi Lambda
- C√≥ quy·ªÅn truy c·∫≠p Bedrock

---

### üîê T·∫°o IAM Role

T·∫°o execution role ƒë·ªÉ Lambda c√≥ th·ªÉ g·ªçi Bedrock v√† Athena.

ƒê·∫ßu ti√™n, t·∫°o role v·ªõi trust policy:

```bash
aws iam create-role \
  --role-name text2sql-lambda-execution-role \
  --assume-role-policy-document '{
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Principal": {
          "Service": "lambda.amazonaws.com"
        },
        "Action": "sts:AssumeRole"
      }
    ]
  }'
```

Trong m√¥i tr∆∞·ªùng test, t√¥i attach c√°c managed policies v·ªõi full access nh∆∞ **AmazonAthena**, **AmazonS3**, **AWSGlueServiceRole**. **‚ö†Ô∏è Trong production, n√™n gi·∫£m xu·ªëng minimum permissions.**

```bash
aws iam attach-role-policy \
  --role-name text2sql-lambda-execution-role \
  --policy-arn arn:aws:iam::aws:policy/AmazonAthenaFullAccess

aws iam attach-role-policy \
  --role-name text2sql-lambda-execution-role \
  --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess

aws iam attach-role-policy \
  --role-name text2sql-lambda-execution-role \
  --policy-arn arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole

aws iam attach-role-policy \
  --role-name text2sql-lambda-execution-role \
  --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
```

Quy·ªÅn truy c·∫≠p **Bedrock** v√† **Lake Formation** ƒë∆∞·ª£c c·∫•p qua **custom policy**:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "bedrock:InvokeModel"
      ],
      "Resource": "arn:aws:bedrock:us-west-2::foundation-model/anthropic.claude-3-5-sonnet-20240620-v1:0"
    },
    {
      "Effect": "Allow",
      "Action": [
        "lakeformation:GetDataAccess"
      ],
      "Resource": "*"
    }
  ]
}
```

```bash
aws iam put-role-policy \
  --role-name text2sql-lambda-execution-role \
  --policy-name LambdaBedrock-S3TablesPolicy \
  --policy-document file://lambda-custom-policy.json
```

---

### üîë C·∫•p quy·ªÅn Iceberg trong Lake Formation

Iceberg tables kh√¥ng th·ªÉ truy c·∫≠p ch·ªâ v·ªõi IAM, c·∫ßn c·∫•p quy·ªÅn **DESCRIBE** / **SELECT** trong **Lake Formation**:

```bash
# Grant DESCRIBE on database
aws lakeformation grant-permissions \
  --principal DataLakePrincipalIdentifier=arn:aws:iam::123456789012:role/text2sql-lambda-execution-role \
  --permissions "DESCRIBE" \
  --resource '{"Database": {"CatalogId": "123456789012", "Name": "data_catalog_link"}}'

# Grant DESCRIBE on S3 Tables catalog
aws lakeformation grant-permissions \
  --principal DataLakePrincipalIdentifier=arn:aws:iam::123456789012:role/text2sql-lambda-execution-role \
  --permissions "DESCRIBE" \
  --resource '{"Database": {"CatalogId": "123456789012:s3tablescatalog/demo-bucket", "Name": "analytics_namespace"}}'

# Grant SELECT and DESCRIBE on table
aws lakeformation grant-permissions \
  --principal DataLakePrincipalIdentifier=arn:aws:iam::123456789012:role/text2sql-lambda-execution-role \
  --permissions "SELECT" "DESCRIBE" \
  --resource '{"Table": {"CatalogId": "123456789012:s3tablescatalog/demo-bucket", "DatabaseName": "analytics_namespace", "Name": "slack_messages"}}'
```

---

### üìä Th√™m test data v√†o table

Trong v√≠ d·ª• n√†y, gi·∫£ ƒë·ªãnh data message t·ª´ Slack, th√™m 1 record v·ªÅ deadline **20/10** v√†o Iceberg table:

```sql
INSERT INTO "AwsDataCatalog"."MCP_DEMO_DB"."slack_messages"
VALUES (
  'MSG-20251008-001',
  '20251008103015999',
  'message_posted',
  'C1234567890',
  'official-announcements',
  'U000BOSS001',
  'ÂêÑ‰Ωç„ÄÅS3Tables MCP „ÅÆÂàùÂõû„É™„É™„Éº„Çπ„ÅØ 10Êúà20Êó• „ÅåÁ∑†Âàá„Åß„Åô„ÄÇÈÅÖÂª∂Âé≥Á¶Å„Åß„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ',
  'T1234567890',
  'EVT-20251008-001',
  current_timestamp,
  date(current_timestamp)
);
```

**N·ªôi dung message:** "C√°c v·ªã, deadline initial release c·ªßa S3Tables MCP l√† **20/10**. Kh√¥ng ƒë∆∞·ª£c ch·∫≠m tr·ªÖ."

---

### üíª Lambda Code

Trong `lambda_function.py`, vi·∫øt code sau. Chi ti·∫øt ƒë∆∞·ª£c ghi trong code. S·ª≠ d·ª•ng `MCPLambdaHandler`, n√™n sau n√†y c·∫ßn bundle dependencies v√†o zip ƒë·ªÉ upload.

#### **Key Components trong Code:**

**1. Global Clients** (ƒë·ªÉ t√°i s·ª≠ d·ª•ng k·∫øt n·ªëi khi warm start):
```python
bedrock_runtime = boto3.client("bedrock-runtime", region_name=AWS_REGION)
athena_client = boto3.client("athena", region_name=AWS_REGION)
s3_client = boto3.client("s3", region_name=AWS_REGION)
```

**2. Environment Variables:**
- `DATABASE_NAME` (default: MCP_DEMO_DB)
- `TABLE_NAME` (default: MCP_DEMO_TABLE)
- `ATHENA_CATALOG` (default: AwsDataCatalog)
- `ATHENA_WORKGROUP` (default: primary)
- `ATHENA_OUTPUT_LOCATION` (S3 path)
- `BEDROCK_MODEL_ID` (default: anthropic.claude-3-5-sonnet-20240620-v1:0)

**3. MCP Tools Implemented:**

#### üîß `test_connection()`
```python
@mcp.tool()
def test_connection() -> str:
    """Tr·∫£ v·ªÅ th√¥ng tin m√¥i tr∆∞·ªùng v√† l∆∞u √Ω khi th·ª±c thi query"""
    return environment_info_and_query_tips
```

**Output:** Configuration info (CATALOG, DATABASE, TABLE, WORKGROUP, etc.) + Query tips

#### üîß `text_to_sql()`
```python
@mcp.tool()
def text_to_sql(
    natural_language_query: str,
    catalog: Optional[str] = None,
    database: Optional[str] = None,
    table: Optional[str] = None,
) -> str:
    """Chuy·ªÉn ƒë·ªïi ng√¥n ng·ªØ t·ª± nhi√™n th√†nh Athena SQL v√† tr·∫£ v·ªÅ JSON"""
```

**Flow:**
1. Build prompt cho Bedrock Claude
2. G·ªçi Bedrock ƒë·ªÉ generate SQL
3. Clean up Markdown formatting (```sql```)
4. Return SQL d∆∞·ªõi d·∫°ng JSON

#### üîß `execute_query()`
```python
@mcp.tool()
def execute_query(
    natural_language_query: Optional[str] = None,
    sql_query: Optional[str] = None,
    catalog: Optional[str] = None,
    database: Optional[str] = None,
    table: Optional[str] = None,
) -> str:
    """Nh·∫≠n ng√¥n ng·ªØ t·ª± nhi√™n ho·∫∑c SQL, th·ª±c thi Athena, v√† t·∫°o summary"""
```

**Flow:**
1. Generate SQL (n·∫øu c√≥ natural_language_query)
2. Start Athena query execution
3. Poll cho ƒë·∫øn khi query complete
4. Collect all result rows
5. Summarize results v·ªõi Bedrock
6. Return JSON v·ªõi: sql, query_execution_id, row_count, rows, summary

#### üîß `fetch_query_results()`
```python
@mcp.tool()
def fetch_query_results(query_execution_id: str) -> str:
    """L·∫•y l·∫°i k·∫øt qu·∫£ th·ª±c thi Athena ƒë√£ ch·∫°y tr∆∞·ªõc ƒë√≥"""
```

**4. Helper Functions:**

- `_build_prompt()` - T·∫°o prompt cho text-to-SQL
- `_invoke_bedrock()` - G·ªçi Bedrock Claude v√† clean output
- `_start_athena_query()` - Start Athena query execution
- `_wait_for_query()` - Poll query status v·ªõi timeout
- `_collect_athena_rows()` - L·∫•y to√†n b·ªô result set
- `_summarise_results()` - T√≥m t·∫Øt k·∫øt qu·∫£ b·∫±ng Bedrock

**5. Lambda Handler:**
```python
def lambda_handler(event: Dict[str, Any], context: Any) -> Dict[str, Any]:
    """MCP JSON-RPC request routing entry point"""
    return mcp.handle_request(event, context)
```

---

### üì¶ Bundle dependencies v√†o zip v√† upload

C·∫ßn `awslabs.mcp_lambda_handler`, n√™n install dependencies v√†o directory v√† upload c√πng v·ªõi `lambda_function.py`:

```bash
mkdir -p package
cp lambda_function.py package/

python3 -m pip install awslabs-mcp-lambda-handler -t package/
python3 -m pip freeze > package/requirements.txt

(cd package && zip -r ../lambda-function-mcp.zip .)
```

**L∆∞u √Ω:** L·∫ßn n√†y dependencies nh·∫π n√™n kh√¥ng d√πng Lambda Layers, bundle tr·ª±c ti·∫øp v√†o zip.

---

### üåê B·∫≠t Function URL

ƒê·ªÉ k·∫øt n·ªëi t·ª´ MCP, t·∫°o **Function URL**.

‚ö†Ô∏è **Security Note:** L·∫ßn n√†y implement **API Key authentication** trong Lambda, nh∆∞ng trong production environment khuy·∫øn ngh·ªã s·ª≠ d·ª•ng:
- **AWS IAM authentication**
- **API Gateway + Authorizer** (Cognito / OIDC, etc.)

#### T·∫°o Function URL

C·∫•u h√¨nh auth-type l√† `NONE`, nh∆∞ng implement API Key authentication b√™n trong Lambda:

```bash
aws lambda create-function-url-config \
  --function-name bedrock-athena-s3tables \
  --auth-type NONE \
  --cors '{"AllowOrigins":["*"],"AllowMethods":["POST"],"AllowHeaders":["content-type"]}' \
  --region us-west-2
```

#### Th√™m public access permission

```bash
aws lambda add-permission \
  --function-name bedrock-athena-s3tables \
  --statement-id function-url-public-access \
  --action lambda:InvokeFunctionUrl \
  --principal '*' \
  --function-url-auth-type NONE \
  --region us-west-2
```

---

### üîí Implement API Key Authentication (trong Lambda)

Trong Lambda function, implement API Key authentication nh∆∞ sau:

```python
def lambda_handler(event: Dict[str, Any], context: Any) -> Dict[str, Any]:
    # API Key authentication
    query_params = event.get("queryStringParameters", {}) or {}
    api_key = query_params.get("key") or query_params.get("api_key")
    
    expected_key = os.environ.get("MCP_API_KEY")
    if not expected_key or api_key != expected_key:
        return {
            "statusCode": 401,
            "headers": {"Content-Type": "application/json"},
            "body": json.dumps({"error": "Invalid or missing API key"})
        }
    
    # Continue with MCP request handling...
```

#### Set environment variable `MCP_API_KEY`

```bash
aws lambda update-function-configuration \
  --function-name bedrock-athena-s3tables \
  --environment Variables='{"MCP_API_KEY":"your-secure-api-key-here"}' \
  --region us-west-2
```

---

### ‚úÖ Ki·ªÉm tra ho·∫°t ƒë·ªông

Sau khi Function URL ƒë∆∞·ª£c issue, test v·ªõi API Key xem c√≥ tr·∫£ v·ªÅ status 200 kh√¥ng:

**‚úÖ V·ªõi API Key (ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng - 200):**

```bash
curl -s -X POST \
  "https://xxxx.lambda-url.us-west-2.on.aws/?api_key=your-secure-api-key-here" \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":"health","method":"initialize","params":{}}'
```

---

## üé≠ Th·ª≠ nghi·ªám tools tr√™n Claude

### C·∫•u h√¨nh Claude UI

1. Click v√†o **icon g√≥c d∆∞·ªõi b√™n tr√°i** trong Claude UI
2. **C√†i ƒë·∫∑t** ‚Üí **„Ç≥„Éç„ÇØ„Çø** ‚Üí **„Ç´„Çπ„Çø„É†„Ç≥„Éç„ÇØ„Çø„ÇíËøΩÂä†**
3. Nh·∫≠p th√¥ng tin:

**Connector Name:**
```
s3tables-lambda-mcp
```

**Remote MCP Server URL:**
```
https://xxxx.lambda-url.us-west-2.on.aws/?api_key=your-secure-api-key-here
```

### Ki·ªÉm tra

Trong chat settings, `s3tables-lambda-mcp` s·∫Ω xu·∫•t hi·ªán.

### Test Query

**C√¢u h·ªèi test:**
```
s3tables„Å´Èñ¢„Åô„ÇãMCP„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆÁ∑†Âàá„Åå„ÅÑ„Å§„Åæ„Åß„ÅãÂàÜ„Åã„Çä„Åæ„Åô„ÅãÔºü
(B·∫°n c√≥ bi·∫øt deadline c·ªßa MCP project li√™n quan ƒë·∫øn s3tables l√† khi n√†o kh√¥ng?)
```

**K·∫øt qu·∫£:**
Claude t·ª± ƒë·ªông:
1. G·ªçi `text_to_sql` ƒë·ªÉ generate SQL
2. G·ªçi `execute_query` ƒë·ªÉ th·ª±c thi tr√™n Athena
3. Ph√¢n t√≠ch message v√† summarize: **"ÂàùÂõû„É™„É™„Éº„Çπ„ÅØ10Êúà20Êó•"** (Initial release l√† 20/10)

‚úÖ **Th√†nh c√¥ng!** Claude ƒë√£ t·ª± ƒë·ªông pick up message v√† tr·∫£ l·ªùi ch√≠nh x√°c!

---

## üéØ T·ªïng k·∫øt

ƒê√£ ho√†n th√†nh x√¢y d·ª±ng **serverless MCP environment** cho ph√©p:

‚úÖ Truy c·∫≠p S3 Tables b·∫±ng **ng√¥n ng·ªØ t·ª± nhi√™n** t·ª´ Claude  
‚úÖ Th√¥ng qua **Athena**  
‚úÖ T·ª± ƒë·ªông **generate SQL** v√† **summarize results**  
‚úÖ Ghi **audit logs** ƒë·∫ßy ƒë·ªß  

Nh·ªù MCP server, c√≥ th·ªÉ truy c·∫≠p data b·∫±ng ng√¥n ng·ªØ t·ª± nhi√™n, gi√∫p tr·∫£ l·ªùi nhanh c√°c c√¢u h·ªèi n·ªôi b·ªô ƒë∆°n gi·∫£n nh∆∞ **"Á∑†Âàá„ÅÑ„Å§Ôºü"** (Deadline khi n√†o?).

---

## üöÄ H∆∞·ªõng ph√°t tri·ªÉn ti·∫øp theo

### C·∫£i thi·ªán b·∫£o m·∫≠t
- ‚úÖ Th√™m **query validation** v√†o `execute_query`
- ‚úÖ T√≠ch h·ª£p **SSO** v√† **permission management**
- ‚úÖ Ki·ªÉm so√°t access ƒë·∫øn Lambda v√† S3 Tables nghi√™m ng·∫∑t h∆°n

### Use cases m·ªü r·ªông
- üìä H·ªá th·ªëng t√¨m ki·∫øm ng√¥n ng·ªØ t·ª± nhi√™n cho internal/external
- üîç Data utilization platform
- üí¨ Chatbot truy v·∫•n data
- üìà Self-service analytics

---

## üìö T√†i li·ªáu tham kh·∫£o

1. **[AWS MCP Lambda Handler GitHub](https://github.com/awslabs/mcp/tree/8d90be5c403af4829a45d8f03093f830ffed6285/src/mcp-lambda-handler)**

2. **[Amazon S3 Tables „Å®„ÉÜ„Éº„Éñ„É´„Éê„Ç±„ÉÉ„Éà„ÅÆ‰ΩøÁî®](https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/userguide/s3-tables.html)**

3. **[Amazon S3 Tables integration with AWS analytics services](https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-tables-integration-overview.html)**

---

## üë§ V·ªÅ t√°c gi·∫£

**Ryuto Yoda (ËàáÁî∞Èæç‰∫∫)**
- **Vai tr√≤:** Â§ßË¶èÊ®°„Éá„Éº„Çø„Ç®„É≥„Ç∏„Éã„Ç¢ (Large-scale Data Engineer)
- **Team:** „Ç∞„É´„Éº„ÉóITÊé®ÈÄ≤Êú¨ÈÉ® ÂÖ®Á§æ„Éá„Éº„ÇøÊäÄË°ìÂ±Ä „Éá„Éº„Çø„Ç§„É≥„ÉÜ„Ç∞„É¨„Éº„Ç∑„Éß„É≥„ÉÅ„Éº„É†
- **C√¥ng vi·ªác:** 
  - Ph√°t tri·ªÉn n·ªÅn t·∫£ng ph√¢n t√≠ch (ÂàÜÊûêÂü∫Áõ§)
  - Ph√°t tri·ªÉn li√™n quan ƒë·∫øn AI Agent
  - C√°c c√¥ng vi·ªác development li√™n quan ƒë·∫øn data utilization
- **GitHub:** [RyutoYoda](https://github.com/RyutoYoda)
- **X (Twitter):** [@ooolong29](https://x.com/ooolong29?s=21)

---

## üí° Key Takeaways

### üéØ Architecture Highlights

1. **MCP Server v·ªõi Lambda**
   - Serverless, auto-scaling
   - Cost-effective
   - Easy deployment

2. **Bedrock Claude Integration**
   - Text-to-SQL generation
   - Result summarization
   - Natural language interface

3. **S3 Tables (Iceberg)**
   - Auto-compaction
   - Table-level permissions
   - Query performance optimization

4. **Security & Governance**
   - API Key authentication
   - Audit logging
   - Lake Formation permissions
   - Bedrock Guardrails

### üìä Benefits Summary

‚úÖ **User-Friendly:** Ng√¥n ng·ªØ t·ª± nhi√™n thay v√¨ SQL  
‚úÖ **Fast Response:** Serverless architecture  
‚úÖ **Secure:** Multi-layer security (IAM, Lake Formation, API Key)  
‚úÖ **Auditable:** Full query and result logging  
‚úÖ **Scalable:** Lambda auto-scaling  
‚úÖ **Cost-Effective:** Pay-per-use model  

### üîß Technical Stack

| Component | Technology | Purpose |
|-----------|-----------|---------|
| **Frontend** | Claude Browser | Natural language interface |
| **Protocol** | MCP | Claude ‚Üî Lambda communication |
| **Compute** | AWS Lambda | MCP Server execution |
| **AI** | Amazon Bedrock (Claude 3.5 Sonnet) | Text-to-SQL + Summarization |
| **Query Engine** | Amazon Athena | SQL execution |
| **Storage** | S3 Tables (Iceberg) | Data lake storage |
| **Security** | IAM + Lake Formation | Permission management |
| **Monitoring** | CloudWatch Logs | Audit trail |

---

## üéâ K·∫øt lu·∫≠n

B√†i vi·∫øt n√†y ƒë√£ tr√¨nh b√†y c√°ch x√¢y d·ª±ng m·ªôt **MCP Server ho√†n ch·ªânh** cho ph√©p query **S3 Tables (Iceberg)** b·∫±ng **ng√¥n ng·ªØ t·ª± nhi√™n** th√¥ng qua:

- **AWS Lambda** (Serverless MCP Server)
- **Amazon Bedrock** (AI-powered text-to-SQL)
- **Amazon Athena** (Query execution)
- **S3 Tables** (Iceberg data storage)

Architecture n√†y k·∫øt h·ª£p ho√†n h·∫£o gi·ªØa:
- ü§ñ **AI capabilities** (natural language understanding)
- üîí **Security** (multi-layer authentication & authorization)
- üìä **Performance** (Iceberg optimization)
- üõ°Ô∏è **Governance** (audit logging & permissions)

ƒê√¢y l√† m·ªôt **reference architecture tuy·ªát v·ªùi** cho c√°c use cases:
- Internal data access democratization
- Self-service analytics
- Natural language data exploration
- Rapid prototyping of data-driven applications

URL: https://developers.cyberagent.co.jp/blog/archives/59292/
T·ªîNG H·ª¢P TH√îNG TIN T·∫†I :https://cola1605.github.io/
